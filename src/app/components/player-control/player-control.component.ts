import { CommonModule } from '@angular/common';
import { Component, OnInit } from '@angular/core';
import { MatIconModule, MatIconRegistry } from '@angular/material/icon';
import { DomSanitizer } from '@angular/platform-browser';
import { ITrack } from '../../interfaces/tracks';
import { SpotifyService } from '../../services/spotify.service';
import { ButtonComponent } from '../button/button.component';
import { SpotifyItemComponent } from '../spotify-item/spotify-item.component';

const icons = {
  next: `<svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
      <mask id="path-1-inside-1_64_216" fill="currentColor">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M22.7714 0C23.3236 0 23.7714 0.447716 23.7714 1V23C23.7714 23.5523 23.3236 24 22.7714 24H20.6337C20.0814 24 19.6337 23.5523 19.6337 23V13.7078L2.94369 23.5551C2.61038 23.7517 2.18962 23.5115 2.18962 23.1245L2.18961 0.866501C2.18961 0.481508 2.60646 0.240959 2.93979 0.433592L19.6337 10.081V1C19.6337 0.447715 20.0814 0 20.6337 0H22.7714Z"/>
      </mask>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M22.7714 0C23.3236 0 23.7714 0.447716 23.7714 1V23C23.7714 23.5523 23.3236 24 22.7714 24H20.6337C20.0814 24 19.6337 23.5523 19.6337 23V13.7078L2.94369 23.5551C2.61038 23.7517 2.18962 23.5115 2.18962 23.1245L2.18961 0.866501C2.18961 0.481508 2.60646 0.240959 2.93979 0.433592L19.6337 10.081V1C19.6337 0.447715 20.0814 0 20.6337 0H22.7714Z" fill="currentColor"/>
      <path d="M19.6337 13.7078L19.1255 12.8465L20.6337 11.9567V13.7078H19.6337ZM2.94369 23.5551L2.43553 22.6938H2.43554L2.94369 23.5551ZM2.18962 23.1245H3.18962H2.18962ZM2.18961 0.866501L1.18961 0.866501V0.866501H2.18961ZM2.93979 0.433592L2.43943 1.29941V1.29941L2.93979 0.433592ZM19.6337 10.081H20.6337V11.8138L19.1333 10.9468L19.6337 10.081ZM22.7714 1V1V-1C23.8759 -1 24.7714 -0.104568 24.7714 1H22.7714ZM22.7714 23V1H24.7714V23H22.7714ZM22.7714 23H22.7714H24.7714C24.7714 24.1046 23.8759 25 22.7714 25V23ZM20.6337 23H22.7714V25H20.6337V23ZM20.6337 23V25C19.5291 25 18.6337 24.1046 18.6337 23H20.6337ZM20.6337 13.7078V23H18.6337V13.7078H20.6337ZM2.43554 22.6938L19.1255 12.8465L20.1418 14.569L3.45185 24.4163L2.43554 22.6938ZM3.18962 23.1245C3.18962 22.7375 2.76885 22.4972 2.43553 22.6938L3.45185 24.4163C2.45192 25.0063 1.18962 24.2855 1.18962 23.1245H3.18962ZM3.18961 0.866501L3.18962 23.1245H1.18962L1.18961 0.866501L3.18961 0.866501ZM2.43943 1.29941C2.77277 1.49204 3.18961 1.2515 3.18961 0.866501H1.18961C1.18961 -0.288479 2.44015 -1.01013 3.44015 -0.432227L2.43943 1.29941ZM19.1333 10.9468L2.43943 1.29941L3.44015 -0.432228L20.134 9.21513L19.1333 10.9468ZM20.6337 1V10.081H18.6337V1H20.6337ZM20.6337 1H18.6337C18.6337 -0.104569 19.5291 -1 20.6337 -1V1ZM22.7714 1H20.6337V-1H22.7714V1Z" fill="currentColor" mask="url(#path-1-inside-1_64_216)"/>
    </svg>`,
  previous: `<svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
      <mask id="path-1-inside-1_64_215" fill="currentColor">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.18958 0C2.63729 0 2.18958 0.447716 2.18958 1V23C2.18958 23.5523 2.63729 24 3.18958 24H5.32728C5.87956 24 6.32728 23.5523 6.32728 23V13.7078L23.0172 23.5551C23.3506 23.7517 23.7713 23.5115 23.7713 23.1245L23.7713 0.866501C23.7713 0.481508 23.3545 0.240959 23.0211 0.433592L6.32728 10.081V1C6.32728 0.447715 5.87956 0 5.32728 0H3.18958Z"/>
      </mask>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M3.18958 0C2.63729 0 2.18958 0.447716 2.18958 1V23C2.18958 23.5523 2.63729 24 3.18958 24H5.32728C5.87956 24 6.32728 23.5523 6.32728 23V13.7078L23.0172 23.5551C23.3506 23.7517 23.7713 23.5115 23.7713 23.1245L23.7713 0.866501C23.7713 0.481508 23.3545 0.240959 23.0211 0.433592L6.32728 10.081V1C6.32728 0.447715 5.87956 0 5.32728 0H3.18958Z" fill="currentColor"/>
      <path d="M6.32728 13.7078L6.83544 12.8465L5.32728 11.9567V13.7078H6.32728ZM23.0172 23.5551L23.5254 22.6938H23.5254L23.0172 23.5551ZM23.7713 23.1245H22.7713H23.7713ZM23.7713 0.866501L24.7713 0.866501V0.866501H23.7713ZM23.0211 0.433592L23.5215 1.29941V1.29941L23.0211 0.433592ZM6.32728 10.081H5.32728V11.8138L6.82763 10.9468L6.32728 10.081ZM3.18958 1V1V-1C2.08501 -1 1.18958 -0.104568 1.18958 1H3.18958ZM3.18958 23V1H1.18958V23H3.18958ZM3.18958 23H3.18958H1.18958C1.18958 24.1046 2.08501 25 3.18958 25V23ZM5.32728 23H3.18958V25H5.32728V23ZM5.32728 23V25C6.43185 25 7.32728 24.1046 7.32728 23H5.32728ZM5.32728 13.7078V23H7.32728V13.7078H5.32728ZM23.5254 22.6938L6.83544 12.8465L5.81912 14.569L22.5091 24.4163L23.5254 22.6938ZM22.7713 23.1245C22.7713 22.7375 23.1921 22.4972 23.5254 22.6938L22.5091 24.4163C23.509 25.0063 24.7713 24.2855 24.7713 23.1245H22.7713ZM22.7713 0.866501L22.7713 23.1245H24.7713L24.7713 0.866501L22.7713 0.866501ZM23.5215 1.29941C23.1882 1.49204 22.7713 1.2515 22.7713 0.866501H24.7713C24.7713 -0.288479 23.5208 -1.01013 22.5208 -0.432227L23.5215 1.29941ZM6.82763 10.9468L23.5215 1.29941L22.5208 -0.432228L5.82692 9.21513L6.82763 10.9468ZM5.32728 1V10.081H7.32728V1H5.32728ZM5.32728 1H7.32728C7.32728 -0.104569 6.43185 -1 5.32728 -1V1ZM3.18958 1H5.32728V-1H3.18958V1Z" fill="currentColor" mask="url(#path-1-inside-1_64_215)"/>
    </svg>`,
  play: `<svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
      <path d="M4.76099 20.1948V3.81427L18.7864 12.0895L4.76099 20.1948Z" fill="currentColor" stroke="currentColor"/>
    </svg>`,
  pause: `<svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" viewBox="0 0 25 24" fill="none">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M6.44458 2.96826C6.16844 2.96826 5.94458 3.19212 5.94458 3.46826V20.5317C5.94458 20.8079 6.16844 21.0317 6.44458 21.0317H9.44458C9.72072 21.0317 9.94458 20.8079 9.94458 20.5317V3.46826C9.94458 3.19212 9.72072 2.96826 9.44458 2.96826H6.44458ZM16.5164 2.96826C16.2402 2.96826 16.0164 3.19212 16.0164 3.46826V20.5317C16.0164 20.8079 16.2402 21.0317 16.5164 21.0317H19.5164C19.7925 21.0317 20.0164 20.8079 20.0164 20.5317V3.46826C20.0164 3.19212 19.7925 2.96826 19.5164 2.96826H16.5164Z" fill="currentColor"/>
    </svg>`,
};

@Component({
  selector: 'app-player-control',
  standalone: true,
  imports: [SpotifyItemComponent, ButtonComponent, MatIconModule, CommonModule],
  templateUrl: './player-control.component.html',
  styleUrl: './player-control.component.scss',
})
export class PlayerControlComponent implements OnInit {
  currentTrack: ITrack = null;

  constructor(
    private SpotifyService: SpotifyService,
    private iconRegistry: MatIconRegistry,
    private sanitizer: DomSanitizer
  ) {
    iconRegistry.addSvgIconLiteral(
      'previous',
      sanitizer.bypassSecurityTrustHtml(icons.previous)
    );
    iconRegistry.addSvgIconLiteral(
      'next',
      sanitizer.bypassSecurityTrustHtml(icons.next)
    );
    iconRegistry.addSvgIconLiteral(
      'play',
      sanitizer.bypassSecurityTrustHtml(icons.play)
    );
    iconRegistry.addSvgIconLiteral(
      'pause',
      sanitizer.bypassSecurityTrustHtml(icons.pause)
    );
  }

  ngOnInit(): void {
    this.getCurrentTrack();
  }

  async getCurrentTrack() {
    this.currentTrack = await this.SpotifyService.getMyCurrentTrack();
  }
}
